# **外卖排序系统生产框架**

![背景设计](https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/1340d0aa.png)
<center>背景设计</center>
<br></br>

外卖策略模型以机器学习驱动，模型迭代效率制约着策略优化效果。在排序系统中，特征是最基础的部分。有特征后，离线训练出模型，然后将模型和特征一起推送给排序服务使用。特征生产Pipeline对于策略迭代的效率起着至关重要的作用。

<br></br>
# What is 通用的特征生产框架？
- 特征生产流程：离线的统计、离线到在线的同步、在线的加载等。

![特征生产Pipeline](https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/d5824c88.png)
<center>特征生产流程</center>

以外卖排序系统为例，外卖排序系统是GBDT树模型。
-缺点：比较复杂，受限于计算能力。
特征生产的主要流程有：
1. **特征统计**：基于基础表（如曝光表、点击表、订单表等），统计若干时段内L，和Spark。产出的特征用于离线训练和线上预测。**
2. **特征推送**：Hive表里的数据需要存入KV(What is KV???),以便线上使用。这一步，首先将Hive表里的记录映射成POJO类(Domain对象)，然后将其序列化，最后序列化存入KV。**这部分工作基于MapReduce实现。**
3. **特征获取**:在线服务根据需求，从KV中取出数据，并反序列化为Domain对象。 
4. **特征加载**:针对模型所需特征列表，取得对应Domain对象，通过调用特征获取实现。

**前两步为离线操作，后两步为在线操作。** 特征同步由离线推送和在线获取共同完成。离线生产流程是一个周期性的Pipeline,目前以天为周期。 

##  新建特征的具体流程